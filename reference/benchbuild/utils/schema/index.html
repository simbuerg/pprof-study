


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.3.0">
    
    
      
        <title>Schema - benchbuild</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6e35a1a6.min.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-benchbuildutilsschema" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="benchbuild" class="md-header-nav__button md-logo" aria-label="benchbuild">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            benchbuild
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Schema
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/PolyJIT/benchbuild/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    benchbuild
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="benchbuild" class="md-nav__button md-logo" aria-label="benchbuild">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    benchbuild
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/PolyJIT/benchbuild/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    benchbuild
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Reference
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Benchbuild
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Benchbuild" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Benchbuild
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../driver/" title="Driver" class="md-nav__link">
      Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../experiment/" title="Experiment" class="md-nav__link">
      Experiment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../likwid/" title="Likwid" class="md-nav__link">
      Likwid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../project/" title="Project" class="md-nav__link">
      Project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../signals/" title="Signals" class="md-nav__link">
      Signals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../statistics/" title="Statistics" class="md-nav__link">
      Statistics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-10" type="checkbox" id="nav-2-1-10">
    
    <label class="md-nav__link" for="nav-2-1-10">
      CLI
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="CLI" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/bootstrap/" title="Bootstrap" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/config/" title="Config" class="md-nav__link">
      Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/experiment/" title="Experiment" class="md-nav__link">
      Experiment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/main/" title="Main" class="md-nav__link">
      Main
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/project/" title="Project" class="md-nav__link">
      Project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/report/" title="Report" class="md-nav__link">
      Report
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/run/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/slurm/" title="Slurm" class="md-nav__link">
      Slurm
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-11" type="checkbox" id="nav-2-1-11">
    
    <label class="md-nav__link" for="nav-2-1-11">
      Db
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Db" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Db
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/manage/" title="Manage" class="md-nav__link">
      Manage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-11-3" type="checkbox" id="nav-2-1-11-3">
    
    <label class="md-nav__link" for="nav-2-1-11-3">
      Versions
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Versions" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-11-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Versions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/versions/001_Remove_RegressionTest_table/" title="001 Remove Regressiontest Table" class="md-nav__link">
      001 Remove Regressiontest Table
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/versions/002_Remove_GlobalConfig_table/" title="002 Remove Globalconfig Table" class="md-nav__link">
      002 Remove Globalconfig Table
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/versions/003_Unmanage_Events/" title="003 Unmanage Events" class="md-nav__link">
      003 Unmanage Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/versions/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-12" type="checkbox" id="nav-2-1-12">
    
    <label class="md-nav__link" for="nav-2-1-12">
      Experiments
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Experiments" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Experiments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../experiments/empty/" title="Empty" class="md-nav__link">
      Empty
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../experiments/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../experiments/raw/" title="Raw" class="md-nav__link">
      Raw
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-13" type="checkbox" id="nav-2-1-13">
    
    <label class="md-nav__link" for="nav-2-1-13">
      Extensions
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Extensions" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Extensions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/base/" title="Base" class="md-nav__link">
      Base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/compiler/" title="Compiler" class="md-nav__link">
      Compiler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/run/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/time/" title="Time" class="md-nav__link">
      Time
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14" type="checkbox" id="nav-2-1-14">
    
    <label class="md-nav__link" for="nav-2-1-14">
      Projects
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Projects" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14-2" type="checkbox" id="nav-2-1-14-2">
    
    <label class="md-nav__link" for="nav-2-1-14-2">
      Apollo
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Apollo" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-14-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Apollo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/apollo/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/apollo/rodinia/" title="Rodinia" class="md-nav__link">
      Rodinia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/apollo/scimark/" title="Scimark" class="md-nav__link">
      Scimark
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14-3" type="checkbox" id="nav-2-1-14-3">
    
    <label class="md-nav__link" for="nav-2-1-14-3">
      Benchbuild
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Benchbuild" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-14-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Benchbuild
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/bots/" title="Bots" class="md-nav__link">
      Bots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/bzip2/" title="Bzip2" class="md-nav__link">
      Bzip2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/ccrypt/" title="Ccrypt" class="md-nav__link">
      Ccrypt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/crafty/" title="Crafty" class="md-nav__link">
      Crafty
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/crocopat/" title="Crocopat" class="md-nav__link">
      Crocopat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/ffmpeg/" title="Ffmpeg" class="md-nav__link">
      Ffmpeg
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/gzip/" title="Gzip" class="md-nav__link">
      Gzip
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/js/" title="Js" class="md-nav__link">
      Js
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/lammps/" title="Lammps" class="md-nav__link">
      Lammps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/lapack/" title="Lapack" class="md-nav__link">
      Lapack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/leveldb/" title="Leveldb" class="md-nav__link">
      Leveldb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/linpack/" title="Linpack" class="md-nav__link">
      Linpack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/lulesh/" title="Lulesh" class="md-nav__link">
      Lulesh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/mcrypt/" title="Mcrypt" class="md-nav__link">
      Mcrypt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/minisat/" title="Minisat" class="md-nav__link">
      Minisat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/openssl/" title="Openssl" class="md-nav__link">
      Openssl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/povray/" title="Povray" class="md-nav__link">
      Povray
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/rasdaman/" title="Rasdaman" class="md-nav__link">
      Rasdaman
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/ruby/" title="Ruby" class="md-nav__link">
      Ruby
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/sdcc/" title="Sdcc" class="md-nav__link">
      Sdcc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/sevenz/" title="Sevenz" class="md-nav__link">
      Sevenz
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/sqlite3/" title="Sqlite3" class="md-nav__link">
      Sqlite3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/tcc/" title="Tcc" class="md-nav__link">
      Tcc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/x264/" title="X264" class="md-nav__link">
      X264
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/benchbuild/xz/" title="Xz" class="md-nav__link">
      Xz
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14-4" type="checkbox" id="nav-2-1-14-4">
    
    <label class="md-nav__link" for="nav-2-1-14-4">
      Gentoo
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Gentoo" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-14-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Gentoo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/autoportage/" title="Autoportage" class="md-nav__link">
      Autoportage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/bzip2/" title="Bzip2" class="md-nav__link">
      Bzip2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/crafty/" title="Crafty" class="md-nav__link">
      Crafty
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/eix/" title="Eix" class="md-nav__link">
      Eix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/gentoo/" title="Gentoo" class="md-nav__link">
      Gentoo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/gzip/" title="Gzip" class="md-nav__link">
      Gzip
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/info/" title="Info" class="md-nav__link">
      Info
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/lammps/" title="Lammps" class="md-nav__link">
      Lammps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/portage_gen/" title="Portage Gen" class="md-nav__link">
      Portage Gen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/postgresql/" title="Postgresql" class="md-nav__link">
      Postgresql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/sevenz/" title="Sevenz" class="md-nav__link">
      Sevenz
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/x264/" title="X264" class="md-nav__link">
      X264
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/gentoo/xz/" title="Xz" class="md-nav__link">
      Xz
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14-5" type="checkbox" id="nav-2-1-14-5">
    
    <label class="md-nav__link" for="nav-2-1-14-5">
      Lnt
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Lnt" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-14-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Lnt
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/lnt/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/lnt/lnt/" title="Lnt" class="md-nav__link">
      Lnt
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14-6" type="checkbox" id="nav-2-1-14-6">
    
    <label class="md-nav__link" for="nav-2-1-14-6">
      Polybench
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Polybench" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-14-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Polybench
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/polybench/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/polybench/polybench-mod/" title="Polybench Mod" class="md-nav__link">
      Polybench Mod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/polybench/polybench/" title="Polybench" class="md-nav__link">
      Polybench
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-14-7" type="checkbox" id="nav-2-1-14-7">
    
    <label class="md-nav__link" for="nav-2-1-14-7">
      Test
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Test" data-md-level="4">
      <label class="md-nav__title" for="nav-2-1-14-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Test
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/test/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/test/test/" title="Test" class="md-nav__link">
      Test
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-15" type="checkbox" id="nav-2-1-15">
    
    <label class="md-nav__link" for="nav-2-1-15">
      Reports
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Reports" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Reports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reports/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reports/raw/" title="Raw" class="md-nav__link">
      Raw
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reports/status/" title="Status" class="md-nav__link">
      Status
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-16" type="checkbox" id="nav-2-1-16" checked>
    
    <label class="md-nav__link" for="nav-2-1-16">
      Utils
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Utils" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Utils
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../actions/" title="Actions" class="md-nav__link">
      Actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bootstrap/" title="Bootstrap" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../compiler/" title="Compiler" class="md-nav__link">
      Compiler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/" title="Db" class="md-nav__link">
      Db
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dict/" title="Dict" class="md-nav__link">
      Dict
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../path/" title="Path" class="md-nav__link">
      Path
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../progress/" title="Progress" class="md-nav__link">
      Progress
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../requirements/" title="Requirements" class="md-nav__link">
      Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../run/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schedule_tree/" title="Schedule Tree" class="md-nav__link">
      Schedule Tree
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Schema" class="md-nav__link md-nav__link--active">
      Schema
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../slurm/" title="Slurm" class="md-nav__link">
      Slurm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tasks/" title="Tasks" class="md-nav__link">
      Tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uchroot/" title="Uchroot" class="md-nav__link">
      Uchroot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unionfs/" title="Unionfs" class="md-nav__link">
      Unionfs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user_interface/" title="User Interface" class="md-nav__link">
      User Interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../versions/" title="Versions" class="md-nav__link">
      Versions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wrapping/" title="Wrapping" class="md-nav__link">
      Wrapping
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/PolyJIT/benchbuild/edit/master/reference/benchbuild/utils/schema.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="module-benchbuildutilsschema">Module benchbuild.utils.schema</h1>
<h1 id="database-schema-for-benchbuild">Database schema for benchbuild</h1>
<p>The schema should initialize itself on an empty database. For now, we do not
support automatic upgrades on schema changes. You might encounter some
roadbumps when using an older version of benchbuild.</p>
<p>Furthermore, for now, we are restricted to postgresql databases, although we
already support arbitrary connection strings via config.</p>
<p>If you want to use reports that use one of our SQL functions, you need to
initialize the functions first using the following command:</p>
<div class="codehilite"><pre><span></span><code>  &gt; <span class="nv">BB_DB_CREATE_FUNCTIONS</span><span class="o">=</span><span class="nb">true</span> benchbuild run -E empty -l
</code></pre></div>


<p>After that you (normally)  do not need to do this agains, unless we supply
a new version that you are interested in.
As soon as we have alembic running, we can provide automatic up/downgrade
paths for you.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>

<span class="sd"># Database schema for benchbuild</span>

<span class="sd">The schema should initialize itself on an empty database. For now, we do not</span>

<span class="sd">support automatic upgrades on schema changes. You might encounter some</span>

<span class="sd">roadbumps when using an older version of benchbuild.</span>

<span class="sd">Furthermore, for now, we are restricted to postgresql databases, although we</span>

<span class="sd">already support arbitrary connection strings via config.</span>

<span class="sd">If you want to use reports that use one of our SQL functions, you need to</span>

<span class="sd">initialize the functions first using the following command:</span>

<span class="sd">```bash</span>

<span class="sd">  &gt; BB_DB_CREATE_FUNCTIONS=true benchbuild run -E empty -l</span>

<span class="sd">```</span>

<span class="sd">After that you (normally)  do not need to do this agains, unless we supply</span>

<span class="sd">a new version that you are interested in.</span>

<span class="sd">As soon as we have alembic running, we can provide automatic up/downgrade</span>

<span class="sd">paths for you.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">import</span> <span class="nn">migrate.versioning.api</span> <span class="kn">as</span> <span class="nn">migrate</span>

<span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="kn">as</span> <span class="nn">sa</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span>

                        <span class="n">ForeignKeyConstraint</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">CHAR</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">TypeDecorator</span>

<span class="kn">from</span> <span class="nn">benchbuild</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="kn">from</span> <span class="nn">benchbuild.utils</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">benchbuild.utils</span> <span class="kn">import</span> <span class="n">user_interface</span> <span class="k">as</span> <span class="n">ui</span>

<span class="n">BASE</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">metadata</span><span class="p">():</span>

    <span class="k">return</span> <span class="n">BASE</span><span class="o">.</span><span class="n">metadata</span>

<span class="k">def</span> <span class="nf">exceptions</span><span class="p">(</span><span class="n">error_is_fatal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">error_messages</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Handle SQLAlchemy exceptions in a sane way.</span>

<span class="sd">    Args:</span>

<span class="sd">        func: An arbitrary function to wrap.</span>

<span class="sd">        error_is_fatal: Should we exit the program on exception?</span>

<span class="sd">        reraise: Should we reraise the exception, after logging? Only makes sense</span>

<span class="sd">            if error_is_fatal is False.</span>

<span class="sd">        error_messages: A dictionary that assigns an exception class to a</span>

<span class="sd">            customized error message.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">exception_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>

        <span class="n">nonlocal</span> <span class="n">error_messages</span>

        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">exc_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

            <span class="n">nonlocal</span> <span class="n">error_messages</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

                <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="n">details</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="n">err_type</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="vm">__class__</span>

                <span class="k">if</span> <span class="n">error_messages</span> <span class="ow">and</span> <span class="n">err_type</span> <span class="ow">in</span> <span class="n">error_messages</span><span class="p">:</span>

                    <span class="n">details</span> <span class="o">=</span> <span class="n">error_messages</span><span class="p">[</span><span class="n">err_type</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">details</span><span class="p">:</span>

                    <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;For developers: (</span><span class="si">%s</span><span class="s2">) </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">error_is_fatal</span><span class="p">:</span>

                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Abort, SQL operation failed.&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">ui</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span>

                        <span class="s2">&quot;I can continue at your own risk, do you want that?&quot;</span><span class="p">):</span>

                    <span class="k">raise</span> <span class="n">err</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">exc_wrapper</span>

    <span class="k">return</span> <span class="n">exception_decorator</span>

<span class="k">class</span> <span class="nc">GUID</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Platform-independent GUID type.</span>

<span class="sd">    Uses Postgresql&#39;s UUID type, otherwise uses</span>

<span class="sd">    CHAR(32), storing as stringified hex values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">impl</span> <span class="o">=</span> <span class="n">CHAR</span>

    <span class="n">as_uuid</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">as_uuid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">as_uuid</span> <span class="o">=</span> <span class="n">as_uuid</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GUID</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_dialect_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">type_descriptor</span><span class="p">(</span><span class="n">UUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">as_uuid</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">type_descriptor</span><span class="p">(</span><span class="n">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Run</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Store a run for each executed test binary.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;run&#39;</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">ForeignKeyConstraint</span><span class="p">(</span>

        <span class="p">[</span><span class="s1">&#39;project_name&#39;</span><span class="p">,</span> <span class="s1">&#39;project_group&#39;</span><span class="p">],</span>

        <span class="p">[</span><span class="s1">&#39;project.name&#39;</span><span class="p">,</span> <span class="s1">&#39;project.group_name&#39;</span><span class="p">],</span>

        <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

        <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),)</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">command</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">project_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">project_group</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">run_group</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">GUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">experiment_group</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">GUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>

                              <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;experiment.id&quot;</span><span class="p">,</span>

                                         <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

                                         <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>

                              <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;run_state&quot;</span><span class="p">))</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">,</span>

                                  <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                                  <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                                  <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">logs</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;RunLog&quot;</span><span class="p">,</span>

                               <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                               <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                               <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">stored_data</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Metadata&quot;</span><span class="p">,</span>

                                      <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                                      <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                                      <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">configurations</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Config&quot;</span><span class="p">,</span>

                                         <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                                         <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                                         <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&lt;Run: {0} status={1} run={2}&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>

                                                        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RunGroup</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Store information about a run group. &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;rungroup&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">GUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">GUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>

                        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;experiment.id&quot;</span><span class="p">,</span>

                                   <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

                                   <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>

                        <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;run_state&quot;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Experiment</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Store metadata about experiments.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;experiment&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">GUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">runs</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Run&quot;</span><span class="p">,</span>

                               <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                               <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                               <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">run_groups</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;RunGroup&quot;</span><span class="p">,</span>

                                     <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                                     <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                                     <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s2">&quot;&lt;Experiment {name}&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Store project metadata.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;project&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">src_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">group_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">runs</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Run&quot;</span><span class="p">,</span>

                               <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>

                               <span class="n">passive_deletes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                               <span class="n">passive_updates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s2">&quot;&lt;Project {group}@{domain}/{name} V:{version}&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>

            <span class="n">group</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_name</span><span class="p">,</span>

            <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>

            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>

            <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Metric</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Store default metrics, simple name value store.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;metrics&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">)</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>

                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;run.id&quot;</span><span class="p">,</span> <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

                               <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>

                    <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                    <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s2">&quot;{0} - {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RunLog</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Store log information for every run.</span>

<span class="sd">    Properties like, start time, finish time, exit code, stderr, stdout</span>

<span class="sd">    are stored here.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>

                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;run.id&quot;</span><span class="p">,</span> <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

                               <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>

                    <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                    <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">stderr</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">stdout</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Metadata</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Store metadata information for every run.</span>

<span class="sd">    If you happen to have some free-form data that belongs to the database,</span>

<span class="sd">    this is the place for it.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;metadata&quot;</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>

                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;run.id&quot;</span><span class="p">,</span> <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

                               <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>

                    <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                    <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">BASE</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Store customized information about a run.</span>

<span class="sd">    You can store arbitrary configuration information about a run here.</span>

<span class="sd">    Use it for extended filtering against the run table.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;config&#39;</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>

                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;run.id&quot;</span><span class="p">,</span> <span class="n">onupdate</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">,</span>

                               <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>

                    <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

                    <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">needed_schema</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">meta</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">CompileError</span> <span class="k">as</span> <span class="n">cerr</span><span class="p">:</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Schema could not be created! Details: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cerr</span><span class="p">))</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">:</span>

        <span class="c1"># SQLite throws an OperationalError</span>

        <span class="c1"># Now try again to add user-defined tables unconditionally.</span>

        <span class="n">meta</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">:</span>

        <span class="c1"># PostgreSQL throws a ProgrammingError</span>

        <span class="c1"># Now try again to add user-defined tables unconditionally.</span>

        <span class="n">meta</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">get_version_data</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot;Retreive migration information.&quot;&quot;&quot;</span>

    <span class="n">connect_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">][</span><span class="s2">&quot;connect_string&quot;</span><span class="p">])</span>

    <span class="n">repo_url</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">template_path</span><span class="p">(</span><span class="s2">&quot;../db/&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">)</span>

<span class="nd">@exceptions</span><span class="p">(</span>

    <span class="n">error_messages</span><span class="o">=</span><span class="p">{</span>

        <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">:</span>

            <span class="s2">&quot;Could not enforce versioning. Are you allowed to modify the database?&quot;</span>

    <span class="p">})</span>

<span class="k">def</span> <span class="nf">enforce_versioning</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Install versioning on the db.&quot;&quot;&quot;</span>

    <span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span> <span class="o">=</span> <span class="n">get_version_data</span><span class="p">()</span>

    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Your database uses an unversioned benchbuild schema.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ui</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span>

            <span class="s2">&quot;Should I enforce version control on your schema?&quot;</span><span class="p">):</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User declined schema versioning.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">repo_version</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="n">repo_url</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">connect_str</span><span class="p">)</span>

    <span class="n">migrate</span><span class="o">.</span><span class="n">version_control</span><span class="p">(</span><span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">repo_version</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">repo_version</span>

<span class="k">def</span> <span class="nf">setup_versioning</span><span class="p">():</span>

    <span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span> <span class="o">=</span> <span class="n">get_version_data</span><span class="p">()</span>

    <span class="n">repo_version</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="n">repo_url</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">connect_str</span><span class="p">)</span>

    <span class="n">db_version</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">requires_versioning</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">db_version</span> <span class="o">=</span> <span class="n">migrate</span><span class="o">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">migrate</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DatabaseNotControlledError</span><span class="p">:</span>

        <span class="n">requires_versioning</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">requires_versioning</span><span class="p">:</span>

        <span class="n">db_version</span> <span class="o">=</span> <span class="n">enforce_versioning</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">repo_version</span><span class="p">,</span> <span class="n">db_version</span><span class="p">)</span>

<span class="nd">@exceptions</span><span class="p">(</span>

    <span class="n">error_messages</span><span class="o">=</span><span class="p">{</span>

        <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">:</span>

            <span class="s2">&quot;Update failed.&quot;</span>

            <span class="s2">&quot; Base schema version diverged from the expected structure.&quot;</span>

    <span class="p">})</span>

<span class="k">def</span> <span class="nf">maybe_update_db</span><span class="p">(</span><span class="n">repo_version</span><span class="p">,</span> <span class="n">db_version</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">db_version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

        <span class="k">return</span>

    <span class="k">if</span> <span class="n">db_version</span> <span class="o">==</span> <span class="n">repo_version</span><span class="p">:</span>

        <span class="k">return</span>

    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Your database contains version &#39;</span><span class="si">%s</span><span class="s2">&#39; of benchbuild&#39;s schema.&quot;</span><span class="p">,</span>

                <span class="n">db_version</span><span class="p">)</span>

    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Benchbuild currently requires version &#39;</span><span class="si">%s</span><span class="s2">&#39; to work correctly.&quot;</span><span class="p">,</span>

                <span class="n">repo_version</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ui</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s2">&quot;Should I attempt to update your schema to version &#39;{0}&#39;?&quot;</span><span class="o">.</span>

                  <span class="n">format</span><span class="p">(</span><span class="n">repo_version</span><span class="p">)):</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User declined schema upgrade.&quot;</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="n">connect_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">][</span><span class="s2">&quot;connect_string&quot;</span><span class="p">])</span>

    <span class="n">repo_url</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">template_path</span><span class="p">(</span><span class="s2">&quot;../db/&quot;</span><span class="p">)</span>

    <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Upgrading to newest version...&quot;</span><span class="p">)</span>

    <span class="n">migrate</span><span class="o">.</span><span class="n">upgrade</span><span class="p">(</span><span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">)</span>

    <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Complete.&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SessionManager</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">connect_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Establish a connection to the database.</span>

<span class="sd">        Provides simple error handling for fatal errors.</span>

<span class="sd">        Returns:</span>

<span class="sd">            True, if we could establish a connection, else False.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">opex</span><span class="p">:</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Could not connect to the database. The error was: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>

                      <span class="nb">str</span><span class="p">(</span><span class="n">opex</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">configure_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Configure the databse connection.</span>

<span class="sd">        Sets appropriate transaction isolation levels and handle errors.</span>

<span class="sd">        Returns:</span>

<span class="sd">            True, if we did not encounter any unrecoverable errors, else False.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;SERIALIZABLE&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">:</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unable to set isolation level to SERIALIZABLE&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="nd">@exceptions</span><span class="p">(</span><span class="n">error_messages</span><span class="o">=</span><span class="p">{</span>

        <span class="n">sa</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">NoSuchModuleError</span><span class="p">:</span> <span class="s2">&quot;Connect string contained an invalid backend.&quot;</span>

    <span class="p">})</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__test_mode</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CFG</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">][</span><span class="s1">&#39;rollback&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">][</span><span class="s2">&quot;connect_string&quot;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connect_engine</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_engine</span><span class="p">()):</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__transaction</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test_mode</span><span class="p">:</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;DB test mode active, all actions will be rolled back.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__transaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">needed_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">BASE</span><span class="o">.</span><span class="n">metadata</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initialized new db schema.&quot;</span><span class="p">)</span>

            <span class="n">repo_version</span> <span class="o">=</span> <span class="n">enforce_versioning</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">repo_version</span><span class="p">,</span> <span class="n">db_version</span> <span class="o">=</span> <span class="n">setup_versioning</span><span class="p">()</span>

            <span class="n">maybe_update_db</span><span class="p">(</span><span class="n">repo_version</span><span class="p">,</span> <span class="n">db_version</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__transaction&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transaction</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__transaction</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">__lazy_session__</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot;Initialize the connection manager lazily.&quot;&quot;&quot;</span>

    <span class="n">connection_manager</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">session</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__lazy_session_wrapped</span><span class="p">():</span>

        <span class="n">nonlocal</span> <span class="n">connection_manager</span>

        <span class="n">nonlocal</span> <span class="n">session</span>

        <span class="k">if</span> <span class="n">connection_manager</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">connection_manager</span> <span class="o">=</span> <span class="n">SessionManager</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">session</span> <span class="o">=</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()()</span>

        <span class="k">return</span> <span class="n">session</span>

    <span class="k">return</span> <span class="n">__lazy_session_wrapped</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">__lazy_session__</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">init_functions</span><span class="p">(</span><span class="n">connection</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Initialize all SQL functions in the database.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">][</span><span class="s2">&quot;create_functions&quot;</span><span class="p">]:</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Refreshing SQL functions...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">template_files</span><span class="p">(</span><span class="s2">&quot;../sql/&quot;</span><span class="p">,</span> <span class="n">exts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.sql&quot;</span><span class="p">]):</span>

            <span class="n">func</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">DDL</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">template_str</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading: &#39;</span><span class="si">%s</span><span class="s2">&#39; into database&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>

            <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

            <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>


</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><code><span class="n">LOG</span>
</code></pre></div>


<h2 id="functions">Functions</h2>
<h3 id="session">Session</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Session</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">__lazy_session_wrapped</span><span class="p">():</span>

        <span class="n">nonlocal</span> <span class="n">connection_manager</span>

        <span class="n">nonlocal</span> <span class="k">session</span>

        <span class="k">if</span> <span class="n">connection_manager</span> <span class="k">is</span> <span class="k">None</span><span class="p">:</span>

            <span class="n">connection_manager</span> <span class="o">=</span> <span class="n">SessionManager</span><span class="p">()</span>

        <span class="k">if</span> <span class="k">session</span> <span class="k">is</span> <span class="k">None</span><span class="p">:</span>

            <span class="k">session</span> <span class="o">=</span> <span class="n">connection_manager</span><span class="p">.</span><span class="k">get</span><span class="p">()()</span>

        <span class="k">return</span> <span class="k">session</span>
</code></pre></div>


</details>
<h3 id="enforce_versioning">enforce_versioning</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">enforce_versioning</span><span class="p">(</span>
    <span class="n">force</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>


<p>Install versioning on the db.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="nv">@exceptions</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="n">error_messages</span><span class="o">=</span><span class="err">{</span><span class="w"></span>

<span class="w">        </span><span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="nl">ProgrammingError</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="ss">&quot;Could not enforce versioning. Are you allowed to modify the database?&quot;</span><span class="w"></span>

<span class="w">    </span><span class="err">}</span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">enforce_versioning</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Install versioning on the db.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">connect_str</span><span class="p">,</span><span class="w"> </span><span class="n">repo_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_version_data</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="nf">LOG</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="ss">&quot;Your database uses an unversioned benchbuild schema.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ui</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="ss">&quot;Should I enforce version control on your schema?&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="nf">LOG</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;User declined schema versioning.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">    </span><span class="n">repo_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">migrate</span><span class="p">.</span><span class="n">version</span><span class="p">(</span><span class="n">repo_url</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="o">=</span><span class="n">connect_str</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">migrate</span><span class="p">.</span><span class="n">version_control</span><span class="p">(</span><span class="n">connect_str</span><span class="p">,</span><span class="w"> </span><span class="n">repo_url</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="n">repo_version</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">repo_version</span><span class="w"></span>
</code></pre></div>


</details>
<h3 id="exceptions">exceptions</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">exceptions</span><span class="p">(</span>
    <span class="n">error_is_fatal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">error_messages</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>


<p>Handle SQLAlchemy exceptions in a sane way.</p>
<p>Args:
    func: An arbitrary function to wrap.
    error_is_fatal: Should we exit the program on exception?
    reraise: Should we reraise the exception, after logging? Only makes sense
        if error_is_fatal is False.
    error_messages: A dictionary that assigns an exception class to a
        customized error message.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">exceptions</span><span class="p">(</span><span class="n">error_is_fatal</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">error_messages</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">    Handle SQLAlchemy exceptions in a sane way.</span>

<span class="ss">    Args:</span>

<span class="ss">        func: An arbitrary function to wrap.</span>

<span class="ss">        error_is_fatal: Should we exit the program on exception?</span>

<span class="ss">        reraise: Should we reraise the exception, after logging? Only makes sense</span>

<span class="ss">            if error_is_fatal is False.</span>

<span class="ss">        error_messages: A dictionary that assigns an exception class to a</span>

<span class="ss">            customized error message.</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">exception_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">error_messages</span><span class="w"></span>

<span class="w">        </span><span class="nv">@functools</span><span class="p">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">exc_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">error_messages</span><span class="w"></span>

<span class="w">            </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="ow">except</span><span class="w"> </span><span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">SQLAlchemyError</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">err</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">                </span><span class="n">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">                </span><span class="n">err_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">__class__</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">error_messages</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">err_type</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">error_messages</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error_messages</span><span class="o">[</span><span class="n">err_type</span><span class="o">]</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nl">details</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="nf">LOG</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">details</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="nf">LOG</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;For developers: (%s) %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">__class__</span><span class="p">,</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nl">error_is_fatal</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">sys</span><span class="p">.</span><span class="k">exit</span><span class="p">(</span><span class="ss">&quot;Abort, SQL operation failed.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ui</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="w"></span>

<span class="w">                        </span><span class="ss">&quot;I can continue at your own risk, do you want that?&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">raise</span><span class="w"> </span><span class="n">err</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">result</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">exc_wrapper</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">exception_decorator</span><span class="w"></span>
</code></pre></div>


</details>
<h3 id="get_version_data">get_version_data</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_version_data</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>


<p>Retreive migration information.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">get_version_data</span><span class="p">():</span>

    <span class="ss">&quot;&quot;&quot;Retreive migration information.&quot;&quot;&quot;</span>

    <span class="n">connect_str</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">CFG</span><span class="p">[</span><span class="ss">&quot;db&quot;</span><span class="p">][</span><span class="ss">&quot;connect_string&quot;</span><span class="p">])</span>

    <span class="n">repo_url</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="n">template_path</span><span class="p">(</span><span class="ss">&quot;../db/&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">)</span>
</code></pre></div>


</details>
<h3 id="init_functions">init_functions</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">init_functions</span><span class="p">(</span>
    <span class="n">connection</span>
<span class="p">)</span>
</code></pre></div>


<p>Initialize all SQL functions in the database.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">init_functions</span><span class="p">(</span><span class="k">connection</span><span class="p">):</span>

    <span class="ss">&quot;&quot;&quot;Initialize all SQL functions in the database.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">settings</span><span class="p">.</span><span class="n">CFG</span><span class="p">[</span><span class="ss">&quot;db&quot;</span><span class="p">][</span><span class="ss">&quot;create_functions&quot;</span><span class="p">]:</span>

        <span class="n">print</span><span class="p">(</span><span class="ss">&quot;Refreshing SQL functions...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file</span> <span class="k">in</span> <span class="n">path</span><span class="p">.</span><span class="n">template_files</span><span class="p">(</span><span class="ss">&quot;../sql/&quot;</span><span class="p">,</span> <span class="n">exts</span><span class="o">=</span><span class="p">[</span><span class="ss">&quot;.sql&quot;</span><span class="p">]):</span>

            <span class="n">func</span> <span class="o">=</span> <span class="n">sa</span><span class="p">.</span><span class="n">DDL</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">template_str</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

            <span class="n">LOG</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="ss">&quot;Loading: &#39;%s&#39; into database&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

            <span class="k">connection</span><span class="p">.</span><span class="k">execute</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

            <span class="k">connection</span><span class="p">.</span><span class="k">commit</span><span class="p">()</span>
</code></pre></div>


</details>
<h3 id="maybe_update_db">maybe_update_db</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">maybe_update_db</span><span class="p">(</span>
    <span class="n">repo_version</span><span class="p">,</span>
    <span class="n">db_version</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="nv">@exceptions</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="n">error_messages</span><span class="o">=</span><span class="err">{</span><span class="w"></span>

<span class="w">        </span><span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="nl">ProgrammingError</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="ss">&quot;Update failed.&quot;</span><span class="w"></span>

<span class="w">            </span><span class="ss">&quot; Base schema version diverged from the expected structure.&quot;</span><span class="w"></span>

<span class="w">    </span><span class="err">}</span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">maybe_update_db</span><span class="p">(</span><span class="n">repo_version</span><span class="p">,</span><span class="w"> </span><span class="n">db_version</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">db_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">db_version</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nl">repo_version</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"></span>

<span class="w">    </span><span class="nf">LOG</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="ss">&quot;Your database contains version &#39;%s&#39; of benchbuild&#39;s schema.&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">                </span><span class="n">db_version</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nf">LOG</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="ss">&quot;Benchbuild currently requires version &#39;%s&#39; to work correctly.&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">                </span><span class="n">repo_version</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ui</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="ss">&quot;Should I attempt to update your schema to version &#39;{0}&#39;?&quot;</span><span class="p">.</span><span class="w"></span>

<span class="w">                  </span><span class="nf">format</span><span class="p">(</span><span class="n">repo_version</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="nf">LOG</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;User declined schema upgrade.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"></span>

<span class="w">    </span><span class="n">connect_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">CFG</span><span class="o">[</span><span class="n">&quot;db&quot;</span><span class="o">][</span><span class="n">&quot;connect_string&quot;</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">repo_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">path</span><span class="p">.</span><span class="n">template_path</span><span class="p">(</span><span class="ss">&quot;../db/&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nf">LOG</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="ss">&quot;Upgrading to newest version...&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">migrate</span><span class="p">.</span><span class="n">upgrade</span><span class="p">(</span><span class="n">connect_str</span><span class="p">,</span><span class="w"> </span><span class="n">repo_url</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nf">LOG</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="ss">&quot;Complete.&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


</details>
<h3 id="metadata">metadata</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">metadata</span><span class="p">():</span>

    <span class="k">return</span> <span class="n">BASE</span><span class="p">.</span><span class="n">metadata</span>
</code></pre></div>


</details>
<h3 id="needed_schema">needed_schema</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">needed_schema</span><span class="p">(</span>
    <span class="n">connection</span><span class="p">,</span>
    <span class="n">meta</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">needed_schema</span><span class="p">(</span><span class="k">connection</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>

    <span class="n">try</span><span class="p">:</span>

        <span class="n">meta</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="k">connection</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">CompileError</span> <span class="k">as</span> <span class="n">cerr</span><span class="p">:</span>

        <span class="n">LOG</span><span class="p">.</span><span class="n">fatal</span><span class="p">(</span><span class="ss">&quot;Schema could not be created! Details: %s&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">(</span><span class="n">cerr</span><span class="p">))</span>

        <span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">OperationalError</span><span class="p">:</span>

        <span class="o">#</span> <span class="n">SQLite</span> <span class="n">throws</span> <span class="n">an</span> <span class="n">OperationalError</span>

        <span class="o">#</span> <span class="n">Now</span> <span class="n">try</span> <span class="n">again</span> <span class="k">to</span> <span class="k">add</span> <span class="k">user</span><span class="o">-</span><span class="k">defined</span> <span class="n">tables</span> <span class="n">unconditionally</span><span class="p">.</span>

        <span class="n">meta</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="k">connection</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="k">False</span>

    <span class="k">except</span> <span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">ProgrammingError</span><span class="p">:</span>

        <span class="o">#</span> <span class="n">PostgreSQL</span> <span class="n">throws</span> <span class="n">a</span> <span class="n">ProgrammingError</span>

        <span class="o">#</span> <span class="n">Now</span> <span class="n">try</span> <span class="n">again</span> <span class="k">to</span> <span class="k">add</span> <span class="k">user</span><span class="o">-</span><span class="k">defined</span> <span class="n">tables</span> <span class="n">unconditionally</span><span class="p">.</span>

        <span class="n">meta</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="k">connection</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="k">False</span>

    <span class="k">return</span> <span class="k">True</span>
</code></pre></div>


</details>
<h3 id="setup_versioning">setup_versioning</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_versioning</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">setup_versioning</span><span class="p">():</span>

    <span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span> <span class="o">=</span> <span class="n">get_version_data</span><span class="p">()</span>

    <span class="n">repo_version</span> <span class="o">=</span> <span class="n">migrate</span><span class="p">.</span><span class="k">version</span><span class="p">(</span><span class="n">repo_url</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">connect_str</span><span class="p">)</span>

    <span class="n">db_version</span> <span class="o">=</span> <span class="k">None</span>

    <span class="n">requires_versioning</span> <span class="o">=</span> <span class="k">False</span>

    <span class="n">try</span><span class="p">:</span>

        <span class="n">db_version</span> <span class="o">=</span> <span class="n">migrate</span><span class="p">.</span><span class="n">db_version</span><span class="p">(</span><span class="n">connect_str</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">migrate</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">DatabaseNotControlledError</span><span class="p">:</span>

        <span class="n">requires_versioning</span> <span class="o">=</span> <span class="k">True</span>

    <span class="k">if</span> <span class="n">requires_versioning</span><span class="p">:</span>

        <span class="n">db_version</span> <span class="o">=</span> <span class="n">enforce_versioning</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">repo_version</span><span class="p">,</span> <span class="n">db_version</span><span class="p">)</span>
</code></pre></div>


</details>
<h2 id="classes">Classes</h2>
<h3 id="base">BASE</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">BASE</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>The base class of the class hierarchy.</p>
<p>When called, it accepts no arguments and returns a new featureless
instance that has no instance attributes and cannot be given any.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="n">Base</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="nv">@declared_attr</span><span class="w"></span>

<span class="w">            </span><span class="n">def</span><span class="w"> </span><span class="n">__tablename__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">.</span><span class="n">__name__</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Column</span><span class="p">(</span><span class="k">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">primary_key</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


</details>
<hr />
<h4 id="descendants">Descendants</h4>
<ul>
<li>benchbuild.utils.schema.Run</li>
<li>benchbuild.utils.schema.RunGroup</li>
<li>benchbuild.utils.schema.Experiment</li>
<li>benchbuild.utils.schema.Project</li>
<li>benchbuild.utils.schema.Metric</li>
<li>benchbuild.utils.schema.RunLog</li>
<li>benchbuild.utils.schema.Metadata</li>
<li>benchbuild.utils.schema.Config</li>
</ul>
<h4 id="class-variables">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<h3 id="config">Config</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store customized information about a run.</p>
<p>You can store arbitrary configuration information about a run here.
Use it for extended filtering against the run table.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Config</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;</span>

<span class="s">    Store customized information about a run.</span>

<span class="s">    You can store arbitrary configuration information about a run here.</span>

<span class="s">    Use it for extended filtering against the run table.</span>

<span class="s">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;config&#39;</span>

    <span class="n">run_id</span> = <span class="n">Column</span>(<span class="n">Integer</span>,

                    <span class="n">ForeignKey</span>(<span class="s">&quot;run.id&quot;</span>, <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>,

                               <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>),

                    <span class="nb">index</span>=<span class="nb">True</span>,

                    <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="nb">name</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="nb">value</span> = <span class="n">Column</span>(<span class="n">String</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_1">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">run_id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">value</span>
</code></pre></div>


<h3 id="experiment">Experiment</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Experiment</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store metadata about experiments.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Experiment</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;Store metadata about experiments.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;experiment&#39;</span>

    <span class="nb">name</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="n">description</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="nb">id</span> = <span class="n">Column</span>(<span class="n">GUID</span>(<span class="n">as_uuid</span>=<span class="nb">True</span>), <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="n">begin</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">end</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="n">runs</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;Run&quot;</span>,

                               <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                               <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                               <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">run_groups</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;RunGroup&quot;</span>,

                                     <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                                     <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                                     <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">def</span> <span class="n">__repr__</span>(<span class="nb">self</span>):

        <span class="k">return</span> <span class="s">&quot;&lt;Experiment {name}&gt;&quot;</span>.<span class="nb">format</span>(<span class="nb">name</span>=<span class="nb">self</span>.<span class="nb">name</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_2">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">begin</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">description</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="nb">id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">run_groups</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">runs</span>
</code></pre></div>


<h3 id="guid">GUID</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">GUID</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">as_uuid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Platform-independent GUID type.</p>
<p>Uses Postgresql's UUID type, otherwise uses
CHAR(32), storing as stringified hex values.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">GUID</span>(<span class="n">TypeDecorator</span>):

    <span class="s">&quot;&quot;&quot;Platform-independent GUID type.</span>

<span class="s">    Uses Postgresql&#39;s UUID type, otherwise uses</span>

<span class="s">    CHAR(32), storing as stringified hex values.</span>

<span class="s">    &quot;&quot;&quot;</span>

    <span class="n">impl</span> = <span class="n">CHAR</span>

    <span class="n">as_uuid</span> = <span class="nb">False</span>

    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, *<span class="nb">args</span>, <span class="n">as_uuid</span>=<span class="nb">False</span>, **<span class="n">kwargs</span>):

        <span class="nb">self</span>.<span class="n">as_uuid</span> = <span class="n">as_uuid</span>

        <span class="n">super</span>(<span class="n">GUID</span>, <span class="nb">self</span>).<span class="n">__init__</span>(*<span class="nb">args</span>, **<span class="n">kwargs</span>)

    <span class="n">def</span> <span class="n">load_dialect_impl</span>(<span class="nb">self</span>, <span class="n">dialect</span>):

        <span class="k">if</span> <span class="n">dialect</span>.<span class="nb">name</span> == <span class="s">&#39;postgresql&#39;</span>:

            <span class="k">return</span> <span class="n">dialect</span>.<span class="n">type_descriptor</span>(<span class="n">UUID</span>(<span class="n">as_uuid</span>=<span class="nb">self</span>.<span class="n">as_uuid</span>))

        <span class="n">else:</span>

            <span class="k">return</span> <span class="n">dialect</span>.<span class="n">type_descriptor</span>(<span class="n">CHAR</span>(<span class="mi">32</span>))

    <span class="n">def</span> <span class="n">process_bind_param</span>(<span class="nb">self</span>, <span class="nb">value</span>, <span class="n">dialect</span>):

        <span class="k">return</span> <span class="n">str</span>(<span class="nb">value</span>)

    <span class="n">def</span> <span class="n">process_result_value</span>(<span class="nb">self</span>, <span class="nb">value</span>, <span class="n">dialect</span>):

        <span class="k">if</span> <span class="n">isinstance</span>(<span class="nb">value</span>, <span class="n">uuid</span>.<span class="n">UUID</span>):

            <span class="k">return</span> <span class="nb">value</span>

        <span class="k">return</span> <span class="n">uuid</span>.<span class="n">UUID</span>(<span class="n">str</span>(<span class="nb">value</span>))
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_2">Ancestors (in MRO)</h4>
<ul>
<li>sqlalchemy.sql.type_api.TypeDecorator</li>
<li>sqlalchemy.sql.base.SchemaEventTarget</li>
<li>sqlalchemy.sql.type_api.TypeEngine</li>
<li>sqlalchemy.sql.visitors.Visitable</li>
</ul>
<h4 id="class-variables_3">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Comparator</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">as_uuid</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">coerce_to_is_types</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">dispatch</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">hashable</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">impl</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">should_evaluate_none</span>
</code></pre></div>


<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">comparator_factory</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">python_type</span>
</code></pre></div>


<p>Return the Python type object expected to be returned
by instances of this type, if known.</p>
<p>Basically, for those types which enforce a return type,
or are known across the board to do such for all common
DBAPIs (like <code>int</code> for example), will return that type.</p>
<p>If a return type is not defined, raises
<code>NotImplementedError</code>.</p>
<p>Note that any type also accommodates NULL in SQL which
means you can also get back <code>None</code> from any type
in practice.</p>
<div class="codehilite"><pre><span></span><code><span class="n">sort_key_function</span>
</code></pre></div>


<h4 id="methods">Methods</h4>
<h5 id="adapt">adapt</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">adapt</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span>
<span class="p">)</span>
</code></pre></div>


<p>Produce an "adapted" form of this type, given an "impl" class
to work with.</p>
<p>This method is used internally to associate generic
types with "implementation" types that are specific to a particular
dialect.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">adapt</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Produce an &quot;</span><span class="n">adapted</span><span class="ss">&quot; form of this type, given an &quot;</span><span class="n">impl</span><span class="ss">&quot; class</span>

<span class="ss">        to work with.</span>

<span class="ss">        This method is used internally to associate generic</span>

<span class="ss">        types with &quot;</span><span class="k">implementation</span><span class="ss">&quot; types that are specific to a particular</span>

<span class="ss">        dialect.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">util</span><span class="p">.</span><span class="n">constructor_copy</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="bind_expression">bind_expression</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bindparam</span>
<span class="p">)</span>
</code></pre></div>


<p>"Given a bind value (i.e. a :class:<code>.BindParameter</code> instance),
return a SQL expression in its place.</p>
<p>This is typically a SQL function that wraps the existing bound
parameter within the statement.  It is used for special data types
that require literals being wrapped in some special database function
in order to coerce an application-level value into a database-specific
format.  It is the SQL analogue of the
:meth:<code>.TypeEngine.bind_processor</code> method.</p>
<p>The method is evaluated at statement compile time, as opposed
to statement construction time.</p>
<p>Note that this method, when implemented, should always return
the exact same structure, without any conditional logic, as it
may be used in an executemany() call against an arbitrary number
of bound parameter sets.</p>
<p>.. seealso::</p>
<div class="codehilite"><pre><span></span><code><span class="p">:</span><span class="n">ref</span><span class="p">:</span><span class="ss">`types_sql_value_processing`</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">bind_expression</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">bindparam</span><span class="p">):</span>

        <span class="k">return</span> <span class="k">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">bind_expression</span><span class="p">(</span><span class="n">bindparam</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="bind_processor">bind_processor</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">bind_processor</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Provide a bound value processing function for the
given :class:<code>.Dialect</code>.</p>
<p>This is the method that fulfills the :class:<code>.TypeEngine</code>
contract for bound value conversion.   :class:<code>.TypeDecorator</code>
will wrap a user-defined implementation of
:meth:<code>process_bind_param</code> here.</p>
<p>User-defined code can override this method directly,
though its likely best to use :meth:<code>process_bind_param</code> so that
the processing provided by <code>self.impl</code> is maintained.</p>
<p>:param dialect: Dialect instance in use.</p>
<p>This method is the reverse counterpart to the
:meth:<code>result_processor</code> method of this class.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">bind_processor</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="s2">&quot;&quot;&quot;Provide a bound value processing function for the</span>

<span class="s2">        given :class:`.Dialect`.</span>

<span class="s2">        This is the method that fulfills the :class:`.TypeEngine`</span>

<span class="s2">        contract for bound value conversion.   :class:`.TypeDecorator`</span>

<span class="s2">        will wrap a user-defined implementation of</span>

<span class="s2">        :meth:`process_bind_param` here.</span>

<span class="s2">        User-defined code can override this method directly,</span>

<span class="s2">        though its likely best to use :meth:`process_bind_param` so that</span>

<span class="s2">        the processing provided by ``self.impl`` is maintained.</span>

<span class="s2">        :param dialect: Dialect instance in use.</span>

<span class="s2">        This method is the reverse counterpart to the</span>

<span class="s2">        :meth:`result_processor` method of this class.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_has_bind_processor</span><span class="p">:</span>

            <span class="n">process_param</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">process_bind_param</span>

            <span class="n">impl_processor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="nf">bind_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">impl_processor</span><span class="p">:</span>

                <span class="n">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

                    <span class="k">return</span> <span class="nf">impl_processor</span><span class="p">(</span><span class="nf">process_param</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

                    <span class="k">return</span> <span class="nf">process_param</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">process</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="nf">bind_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="coerce_compared_value">coerce_compared_value</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">coerce_compared_value</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">op</span><span class="p">,</span>
    <span class="n">value</span>
<span class="p">)</span>
</code></pre></div>


<p>Suggest a type for a 'coerced' Python value in an expression.</p>
<p>By default, returns self.   This method is called by
the expression system when an object using this type is
on the left or right side of an expression against a plain Python
object which does not yet have a SQLAlchemy type assigned::</p>
<div class="codehilite"><pre><span></span><code><span class="err">expr = table.c.somecolumn + 35</span>
</code></pre></div>


<p>Where above, if <code>somecolumn</code> uses this type, this method will
be called with the value <code>operator.add</code>
and <code>35</code>.  The return value is whatever SQLAlchemy type should
be used for <code>35</code> for this particular operation.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">coerce_compared_value</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="s2">&quot;&quot;&quot;Suggest a type for a &#39;coerced&#39; Python value in an expression.</span>

<span class="s2">        By default, returns self.   This method is called by</span>

<span class="s2">        the expression system when an object using this type is</span>

<span class="s2">        on the left or right side of an expression against a plain Python</span>

<span class="s2">        object which does not yet have a SQLAlchemy type assigned::</span>

<span class="s2">            expr = table.c.somecolumn + 35</span>

<span class="s2">        Where above, if ``somecolumn`` uses this type, this method will</span>

<span class="s2">        be called with the value ``operator.add``</span>

<span class="s2">        and ``35``.  The return value is whatever SQLAlchemy type should</span>

<span class="s2">        be used for ``35`` for this particular operation.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">self</span>
</code></pre></div>


</details>
<h5 id="column_expression">column_expression</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">column</span>
<span class="p">)</span>
</code></pre></div>


<p>Given a SELECT column expression, return a wrapping SQL expression.</p>
<p>This is typically a SQL function that wraps a column expression
as rendered in the columns clause of a SELECT statement.
It is used for special data types that require
columns to be wrapped in some special database function in order
to coerce the value before being sent back to the application.
It is the SQL analogue of the :meth:<code>.TypeEngine.result_processor</code>
method.</p>
<p>The method is evaluated at statement compile time, as opposed
to statement construction time.</p>
<p>.. seealso::</p>
<div class="codehilite"><pre><span></span><code><span class="p">:</span><span class="n">ref</span><span class="p">:</span><span class="ss">`types_sql_value_processing`</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">column_expression</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="k">column</span><span class="p">):</span>

        <span class="k">return</span> <span class="k">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">column_expression</span><span class="p">(</span><span class="k">column</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="compare_against_backend">compare_against_backend</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">compare_against_backend</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span><span class="p">,</span>
    <span class="n">conn_type</span>
<span class="p">)</span>
</code></pre></div>


<p>Compare this type against the given backend type.</p>
<p>This function is currently not implemented for SQLAlchemy
types, and for all built in types will return <code>None</code>.  However,
it can be implemented by a user-defined type
where it can be consumed by schema comparison tools such as
Alembic autogenerate.</p>
<p>A future release of SQLAlchemy will potentially implement this method
for builtin types as well.</p>
<p>The function should return True if this type is equivalent to the
given type; the type is typically reflected from the database
so should be database specific.  The dialect in use is also
passed.   It can also return False to assert that the type is
not equivalent.</p>
<p>:param dialect: a :class:<code>.Dialect</code> that is involved in the comparison.</p>
<p>:param conn_type: the type object reflected from the backend.</p>
<p>.. versionadded:: 1.0.3</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">compare_against_backend</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">conn_type</span><span class="p">):</span>

        <span class="s2">&quot;&quot;&quot;Compare this type against the given backend type.</span>

<span class="s2">        This function is currently not implemented for SQLAlchemy</span>

<span class="s2">        types, and for all built in types will return ``None``.  However,</span>

<span class="s2">        it can be implemented by a user-defined type</span>

<span class="s2">        where it can be consumed by schema comparison tools such as</span>

<span class="s2">        Alembic autogenerate.</span>

<span class="s2">        A future release of SQLAlchemy will potentially implement this method</span>

<span class="s2">        for builtin types as well.</span>

<span class="s2">        The function should return True if this type is equivalent to the</span>

<span class="s2">        given type; the type is typically reflected from the database</span>

<span class="s2">        so should be database specific.  The dialect in use is also</span>

<span class="s2">        passed.   It can also return False to assert that the type is</span>

<span class="s2">        not equivalent.</span>

<span class="s2">        :param dialect: a :class:`.Dialect` that is involved in the comparison.</span>

<span class="s2">        :param conn_type: the type object reflected from the backend.</span>

<span class="s2">        .. versionadded:: 1.0.3</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">None</span>
</code></pre></div>


</details>
<h5 id="compare_values">compare_values</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">compare_values</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span>
<span class="p">)</span>
</code></pre></div>


<p>Given two values, compare them for equality.</p>
<p>By default this calls upon :meth:<code>.TypeEngine.compare_values</code>
of the underlying "impl", which in turn usually
uses the Python equals operator <code>==</code>.</p>
<p>This function is used by the ORM to compare
an original-loaded value with an intercepted
"changed" value, to determine if a net change
has occurred.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">compare_values</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Given two values, compare them for equality.</span>

<span class="ss">        By default this calls upon :meth:`.TypeEngine.compare_values`</span>

<span class="ss">        of the underlying &quot;</span><span class="n">impl</span><span class="ss">&quot;, which in turn usually</span>

<span class="ss">        uses the Python equals operator ``==``.</span>

<span class="ss">        This function is used by the ORM to compare</span>

<span class="ss">        an original-loaded value with an intercepted</span>

<span class="ss">        &quot;</span><span class="n">changed</span><span class="ss">&quot; value, to determine if a net change</span>

<span class="ss">        has occurred.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="k">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">compare_values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="compile">compile</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">compile</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>


<p>Produce a string-compiled form of this :class:<code>.TypeEngine</code>.</p>
<p>When called with no arguments, uses a "default" dialect
to produce a string result.</p>
<p>:param dialect: a :class:<code>.Dialect</code> instance.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">compile</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Produce a string-compiled form of this :class:`.TypeEngine`.</span>

<span class="ss">        When called with no arguments, uses a &quot;</span><span class="k">default</span><span class="ss">&quot; dialect</span>

<span class="ss">        to produce a string result.</span>

<span class="ss">        :param dialect: a :class:`.Dialect` instance.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="o">#</span> <span class="n">arg</span><span class="p">,</span> <span class="k">return</span> <span class="n">value</span> <span class="k">is</span> <span class="n">inconsistent</span> <span class="k">with</span>

        <span class="o">#</span> <span class="n">ClauseElement</span><span class="p">.</span><span class="n">compile</span><span class="p">()....</span><span class="n">this</span> <span class="k">is</span> <span class="n">a</span> <span class="n">mistake</span><span class="p">.</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">dialect</span><span class="p">:</span>

            <span class="n">dialect</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">_default_dialect</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dialect</span><span class="p">.</span><span class="n">type_compiler</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="copy">copy</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span>
<span class="p">)</span>
</code></pre></div>


<p>Produce a copy of this :class:<code>.TypeDecorator</code> instance.</p>
<p>This is a shallow copy and is provided to fulfill part of
the :class:<code>.TypeEngine</code> contract.  It usually does not
need to be overridden unless the user-defined :class:<code>.TypeDecorator</code>
has local state that should be deep-copied.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">copy</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Produce a copy of this :class:`.TypeDecorator` instance.</span>

<span class="ss">        This is a shallow copy and is provided to fulfill part of</span>

<span class="ss">        the :class:`.TypeEngine` contract.  It usually does not</span>

<span class="ss">        need to be overridden unless the user-defined :class:`.TypeDecorator`</span>

<span class="ss">        has local state that should be deep-copied.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">)</span>

        <span class="n">instance</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span>
</code></pre></div>


</details>
<h5 id="copy_value">copy_value</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy_value</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">copy_value</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>


</details>
<h5 id="dialect_impl">dialect_impl</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">dialect_impl</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Return a dialect-specific implementation for this
:class:<code>.TypeEngine</code>.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">dialect_impl</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">dialect</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Return a dialect-specific implementation for this</span>

<span class="ss">        :class:`.TypeEngine`.</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dialect</span><span class="p">.</span><span class="n">_type_memos</span><span class="o">[</span><span class="n">self</span><span class="o">][</span><span class="n">&quot;impl&quot;</span><span class="o">]</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">KeyError</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_dialect_info</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span><span class="o">[</span><span class="n">&quot;impl&quot;</span><span class="o">]</span><span class="w"></span>
</code></pre></div>


</details>
<h5 id="evaluates_none">evaluates_none</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">evaluates_none</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>


<p>Return a copy of this type which has the :attr:<code>.should_evaluate_none</code>
flag set to True.</p>
<p>E.g.::</p>
<div class="codehilite"><pre><span></span><code><span class="err">    Table(</span>
<span class="err">        &#39;some_table&#39;, metadata,</span>
<span class="err">        Column(</span>
<span class="err">            String(50).evaluates_none(),</span>
<span class="err">            nullable=True,</span>
<span class="err">            server_default=&#39;no value&#39;)</span>
<span class="err">    )</span>
</code></pre></div>


<p>The ORM uses this flag to indicate that a positive value of <code>None</code>
is passed to the column in an INSERT statement, rather than omitting
the column from the INSERT statement which has the effect of firing
off column-level defaults.   It also allows for types which have
special behavior associated with the Python None value to indicate
that the value doesn't necessarily translate into SQL NULL; a
prime example of this is a JSON type which may wish to persist the
JSON value <code>'null'</code>.</p>
<p>In all cases, the actual NULL SQL value can be always be
persisted in any column by using
the :obj:<code>_expression.null</code> SQL construct in an INSERT statement
or associated with an ORM-mapped attribute.</p>
<p>.. note::</p>
<div class="codehilite"><pre><span></span><code><span class="n">The</span> <span class="s2">&quot;evaluates none&quot;</span> <span class="n">flag</span> <span class="n">does</span> <span class="o">**</span><span class="k">not</span><span class="o">**</span> <span class="n">apply</span> <span class="k">to</span> <span class="n">a</span> <span class="n">value</span>
<span class="n">of</span> <span class="ss">``</span><span class="n">None</span><span class="ss">``</span> <span class="n">passed</span> <span class="k">to</span> <span class="p">:</span><span class="n">paramref</span><span class="p">:</span><span class="ss">`_schema.Column.default`</span> <span class="k">or</span>
<span class="p">:</span><span class="n">paramref</span><span class="p">:</span><span class="ss">`_schema.Column.server_default`</span><span class="p">;</span> <span class="k">in</span> <span class="n">these</span> <span class="n">cases</span><span class="p">,</span>
<span class="ss">``</span><span class="n">None</span><span class="ss">``</span>
<span class="n">still</span> <span class="n">means</span> <span class="s2">&quot;no default&quot;</span><span class="p">.</span>
</code></pre></div>


<p>.. versionadded:: 1.1</p>
<p>.. seealso::</p>
<div class="codehilite"><pre><span></span><code><span class="p">:</span><span class="n">ref</span><span class="p">:</span><span class="ss">`session_forcing_null`</span> <span class="o">-</span> <span class="k">in</span> <span class="n">the</span> <span class="n">ORM</span> <span class="n">documentation</span>

<span class="p">:</span><span class="n">paramref</span><span class="p">:</span><span class="ss">`.postgresql.JSON.none_as_null`</span> <span class="o">-</span> <span class="n">PostgreSQL</span> <span class="n">JSON</span>
<span class="n">interaction</span> <span class="k">with</span> <span class="n">this</span> <span class="n">flag</span><span class="p">.</span>

<span class="p">:</span><span class="n">attr</span><span class="p">:</span><span class="ss">`.TypeEngine.should_evaluate_none`</span> <span class="o">-</span> <span class="n">class</span><span class="o">-</span><span class="n">level</span> <span class="n">flag</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">evaluates_none</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>

        <span class="s2">&quot;&quot;&quot;Return a copy of this type which has the :attr:`.should_evaluate_none`</span>

<span class="s2">        flag set to True.</span>

<span class="s2">        E.g.::</span>

<span class="s2">                Table(</span>

<span class="s2">                    &#39;some_table&#39;, metadata,</span>

<span class="s2">                    Column(</span>

<span class="s2">                        String(50).evaluates_none(),</span>

<span class="s2">                        nullable=True,</span>

<span class="s2">                        server_default=&#39;no value&#39;)</span>

<span class="s2">                )</span>

<span class="s2">        The ORM uses this flag to indicate that a positive value of ``None``</span>

<span class="s2">        is passed to the column in an INSERT statement, rather than omitting</span>

<span class="s2">        the column from the INSERT statement which has the effect of firing</span>

<span class="s2">        off column-level defaults.   It also allows for types which have</span>

<span class="s2">        special behavior associated with the Python None value to indicate</span>

<span class="s2">        that the value doesn&#39;t necessarily translate into SQL NULL; a</span>

<span class="s2">        prime example of this is a JSON type which may wish to persist the</span>

<span class="s2">        JSON value ``&#39;null&#39;``.</span>

<span class="s2">        In all cases, the actual NULL SQL value can be always be</span>

<span class="s2">        persisted in any column by using</span>

<span class="s2">        the :obj:`_expression.null` SQL construct in an INSERT statement</span>

<span class="s2">        or associated with an ORM-mapped attribute.</span>

<span class="s2">        .. note::</span>

<span class="s2">            The &quot;</span><span class="n">evaluates</span> <span class="n">none</span><span class="s2">&quot; flag does **not** apply to a value</span>

<span class="s2">            of ``None`` passed to :paramref:`_schema.Column.default` or</span>

<span class="s2">            :paramref:`_schema.Column.server_default`; in these cases,</span>

<span class="s2">            ``None``</span>

<span class="s2">            still means &quot;</span><span class="n">no</span> <span class="k">default</span><span class="s2">&quot;.</span>

<span class="s2">        .. versionadded:: 1.1</span>

<span class="s2">        .. seealso::</span>

<span class="s2">            :ref:`session_forcing_null` - in the ORM documentation</span>

<span class="s2">            :paramref:`.postgresql.JSON.none_as_null` - PostgreSQL JSON</span>

<span class="s2">            interaction with this flag.</span>

<span class="s2">            :attr:`.TypeEngine.should_evaluate_none` - class-level flag</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>

        <span class="n">typ</span><span class="p">.</span><span class="n">should_evaluate_none</span> <span class="o">=</span> <span class="no">True</span>

        <span class="k">return</span> <span class="n">typ</span>
</code></pre></div>


</details>
<h5 id="get_dbapi_type">get_dbapi_type</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_dbapi_type</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dbapi</span>
<span class="p">)</span>
</code></pre></div>


<p>Return the DBAPI type object represented by this
:class:<code>.TypeDecorator</code>.</p>
<p>By default this calls upon :meth:<code>.TypeEngine.get_dbapi_type</code> of the
underlying "impl".</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">get_dbapi_type</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">dbapi</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Return the DBAPI type object represented by this</span>

<span class="ss">        :class:`.TypeDecorator`.</span>

<span class="ss">        By default this calls upon :meth:`.TypeEngine.get_dbapi_type` of the</span>

<span class="ss">        underlying &quot;</span><span class="n">impl</span><span class="ss">&quot;.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="k">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">get_dbapi_type</span><span class="p">(</span><span class="n">dbapi</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="literal_processor">literal_processor</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">literal_processor</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Provide a literal processing function for the given
:class:<code>.Dialect</code>.</p>
<p>Subclasses here will typically override
:meth:<code>.TypeDecorator.process_literal_param</code> instead of this method
directly.</p>
<p>By default, this method makes use of
:meth:<code>.TypeDecorator.process_bind_param</code> if that method is
implemented, where :meth:<code>.TypeDecorator.process_literal_param</code> is
not.  The rationale here is that :class:<code>.TypeDecorator</code> typically
deals with Python conversions of data that are above the layer of
database presentation.  With the value converted by
:meth:<code>.TypeDecorator.process_bind_param</code>, the underlying type will
then handle whether it needs to be presented to the DBAPI as a bound
parameter or to the database as an inline SQL value.</p>
<p>.. versionadded:: 0.9.0</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">literal_processor</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Provide a literal processing function for the given</span>

<span class="ss">        :class:`.Dialect`.</span>

<span class="ss">        Subclasses here will typically override</span>

<span class="ss">        :meth:`.TypeDecorator.process_literal_param` instead of this method</span>

<span class="ss">        directly.</span>

<span class="ss">        By default, this method makes use of</span>

<span class="ss">        :meth:`.TypeDecorator.process_bind_param` if that method is</span>

<span class="ss">        implemented, where :meth:`.TypeDecorator.process_literal_param` is</span>

<span class="ss">        not.  The rationale here is that :class:`.TypeDecorator` typically</span>

<span class="ss">        deals with Python conversions of data that are above the layer of</span>

<span class="ss">        database presentation.  With the value converted by</span>

<span class="ss">        :meth:`.TypeDecorator.process_bind_param`, the underlying type will</span>

<span class="ss">        then handle whether it needs to be presented to the DBAPI as a bound</span>

<span class="ss">        parameter or to the database as an inline SQL value.</span>

<span class="ss">        .. versionadded:: 0.9.0</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="k">self</span><span class="p">.</span><span class="n">_has_literal_processor</span><span class="p">:</span>

            <span class="n">process_param</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">process_literal_param</span>

        <span class="n">elif</span> <span class="k">self</span><span class="p">.</span><span class="n">_has_bind_processor</span><span class="p">:</span>

            <span class="o">#</span> <span class="n">the</span> <span class="n">bind</span> <span class="n">processor</span> <span class="n">should</span> <span class="n">normally</span> <span class="n">be</span> <span class="n">OK</span>

            <span class="o">#</span> <span class="k">for</span> <span class="n">TypeDecorator</span> <span class="n">since</span> <span class="n">it</span> <span class="n">isn</span><span class="s1">&#39;t doing DB-level</span>

<span class="s1">            # handling, the handling here won&#39;</span><span class="n">t</span> <span class="n">be</span> <span class="n">different</span> <span class="k">for</span> <span class="n">bound</span> <span class="n">vs</span><span class="p">.</span>

            <span class="o">#</span> <span class="n">literals</span><span class="p">.</span>

            <span class="n">process_param</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">process_bind_param</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">process_param</span> <span class="o">=</span> <span class="k">None</span>

        <span class="k">if</span> <span class="n">process_param</span><span class="p">:</span>

            <span class="n">impl_processor</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">literal_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">impl_processor</span><span class="p">:</span>

                <span class="n">def</span> <span class="n">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

                    <span class="k">return</span> <span class="n">impl_processor</span><span class="p">(</span><span class="n">process_param</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">def</span> <span class="n">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

                    <span class="k">return</span> <span class="n">process_param</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">process</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="k">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">literal_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="load_dialect_impl">load_dialect_impl</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">load_dialect_impl</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Return a :class:<code>.TypeEngine</code> object corresponding to a dialect.</p>
<p>This is an end-user override hook that can be used to provide
differing types depending on the given dialect.  It is used
by the :class:<code>.TypeDecorator</code> implementation of :meth:<code>type_engine</code>
to help determine what type should ultimately be returned
for a given :class:<code>.TypeDecorator</code>.</p>
<p>By default returns <code>self.impl</code>.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">load_dialect_impl</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">dialect</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">dialect</span><span class="p">.</span><span class="n">type_descriptor</span><span class="p">(</span><span class="n">UUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="k">self</span><span class="p">.</span><span class="n">as_uuid</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">dialect</span><span class="p">.</span><span class="n">type_descriptor</span><span class="p">(</span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
</code></pre></div>


</details>
<h5 id="process_bind_param">process_bind_param</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Receive a bound parameter value to be converted.</p>
<p>Subclasses override this method to return the
value that should be passed along to the underlying
:class:<code>.TypeEngine</code> object, and from there to the
DBAPI <code>execute()</code> method.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<p>This operation should be designed with the reverse operation
in mind, which would be the process_result_value method of
this class.</p>
<p>:param value: Data to operate upon, of any type expected by
 this method in the subclass.  Can be <code>None</code>.
:param dialect: the :class:<code>.Dialect</code> in use.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">process_bind_param</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="process_literal_param">process_literal_param</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">process_literal_param</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Receive a literal parameter value to be rendered inline within
a statement.</p>
<p>This method is used when the compiler renders a
literal value without using binds, typically within DDL
such as in the "server default" of a column or an expression
within a CHECK constraint.</p>
<p>The returned string will be rendered into the output string.</p>
<p>.. versionadded:: 0.9.0</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">process_literal_param</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Receive a literal parameter value to be rendered inline within</span>

<span class="ss">        a statement.</span>

<span class="ss">        This method is used when the compiler renders a</span>

<span class="ss">        literal value without using binds, typically within DDL</span>

<span class="ss">        such as in the &quot;</span><span class="n">server</span> <span class="k">default</span><span class="ss">&quot; of a column or an expression</span>

<span class="ss">        within a CHECK constraint.</span>

<span class="ss">        The returned string will be rendered into the output string.</span>

<span class="ss">        .. versionadded:: 0.9.0</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="n">raise</span> <span class="n">NotImplementedError</span><span class="p">()</span>
</code></pre></div>


</details>
<h5 id="process_result_value">process_result_value</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Receive a result-row column value to be converted.</p>
<p>Subclasses should implement this method to operate on data
fetched from the database.</p>
<p>Subclasses override this method to return the
value that should be passed back to the application,
given a value that is already processed by
the underlying :class:<code>.TypeEngine</code> object, originally
from the DBAPI cursor method <code>fetchone()</code> or similar.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<p>:param value: Data to operate upon, of any type expected by
 this method in the subclass.  Can be <code>None</code>.
:param dialect: the :class:<code>.Dialect</code> in use.</p>
<p>This operation should be designed to be reversible by
the "process_bind_param" method of this class.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">process_result_value</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">uuid</span><span class="p">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</code></pre></div>


</details>
<h5 id="result_processor">result_processor</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">result_processor</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span><span class="p">,</span>
    <span class="n">coltype</span>
<span class="p">)</span>
</code></pre></div>


<p>Provide a result value processing function for the given
:class:<code>.Dialect</code>.</p>
<p>This is the method that fulfills the :class:<code>.TypeEngine</code>
contract for result value conversion.   :class:<code>.TypeDecorator</code>
will wrap a user-defined implementation of
:meth:<code>process_result_value</code> here.</p>
<p>User-defined code can override this method directly,
though its likely best to use :meth:<code>process_result_value</code> so that
the processing provided by <code>self.impl</code> is maintained.</p>
<p>:param dialect: Dialect instance in use.
:param coltype: A SQLAlchemy data type</p>
<p>This method is the reverse counterpart to the
:meth:<code>bind_processor</code> method of this class.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">result_processor</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">):</span>

        <span class="s2">&quot;&quot;&quot;Provide a result value processing function for the given</span>

<span class="s2">        :class:`.Dialect`.</span>

<span class="s2">        This is the method that fulfills the :class:`.TypeEngine`</span>

<span class="s2">        contract for result value conversion.   :class:`.TypeDecorator`</span>

<span class="s2">        will wrap a user-defined implementation of</span>

<span class="s2">        :meth:`process_result_value` here.</span>

<span class="s2">        User-defined code can override this method directly,</span>

<span class="s2">        though its likely best to use :meth:`process_result_value` so that</span>

<span class="s2">        the processing provided by ``self.impl`` is maintained.</span>

<span class="s2">        :param dialect: Dialect instance in use.</span>

<span class="s2">        :param coltype: A SQLAlchemy data type</span>

<span class="s2">        This method is the reverse counterpart to the</span>

<span class="s2">        :meth:`bind_processor` method of this class.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_has_result_processor</span><span class="p">:</span>

            <span class="n">process_value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">process_result_value</span>

            <span class="n">impl_processor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="nf">result_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">impl_processor</span><span class="p">:</span>

                <span class="n">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

                    <span class="k">return</span> <span class="nf">process_value</span><span class="p">(</span><span class="nf">impl_processor</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">dialect</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

                    <span class="k">return</span> <span class="nf">process_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">process</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="nf">result_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="type_engine">type_engine</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">type_engine</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dialect</span>
<span class="p">)</span>
</code></pre></div>


<p>Return a dialect-specific :class:<code>.TypeEngine</code> instance
for this :class:<code>.TypeDecorator</code>.</p>
<p>In most cases this returns a dialect-adapted form of
the :class:<code>.TypeEngine</code> type represented by <code>self.impl</code>.
Makes usage of :meth:<code>dialect_impl</code> but also traverses
into wrapped :class:<code>.TypeDecorator</code> instances.
Behavior can be customized here by overriding
:meth:<code>load_dialect_impl</code>.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">type_engine</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>

        <span class="s2">&quot;&quot;&quot;Return a dialect-specific :class:`.TypeEngine` instance</span>

<span class="s2">        for this :class:`.TypeDecorator`.</span>

<span class="s2">        In most cases this returns a dialect-adapted form of</span>

<span class="s2">        the :class:`.TypeEngine` type represented by ``self.impl``.</span>

<span class="s2">        Makes usage of :meth:`dialect_impl` but also traverses</span>

<span class="s2">        into wrapped :class:`.TypeDecorator` instances.</span>

<span class="s2">        Behavior can be customized here by overriding</span>

<span class="s2">        :meth:`load_dialect_impl`.</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">adapted</span> <span class="o">=</span> <span class="n">dialect</span><span class="p">.</span><span class="nf">type_descriptor</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="k">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">adapted</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="n">self</span><span class="p">)):</span>

            <span class="k">return</span> <span class="n">adapted</span>

        <span class="n">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">impl</span><span class="p">,</span> <span class="n">TypeDecorator</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="nf">type_engine</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">load_dialect_impl</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="with_variant">with_variant</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">with_variant</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">type_</span><span class="p">,</span>
    <span class="n">dialect_name</span>
<span class="p">)</span>
</code></pre></div>


<p>Produce a new type object that will utilize the given
type when applied to the dialect of the given name.</p>
<p>e.g.::</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">mysql</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">mysql</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">(</span><span class="n">collation</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="s1">&#39;mysql&#39;</span><span class="p">)</span>
</code></pre></div>


<p>The construction of :meth:<code>.TypeEngine.with_variant</code> is always
from the "fallback" type to that which is dialect specific.
The returned type is an instance of :class:<code>.Variant</code>, which
itself provides a :meth:<code>.Variant.with_variant</code>
that can be called repeatedly.</p>
<p>:param type_: a :class:<code>.TypeEngine</code> that will be selected
 as a variant from the originating type, when a dialect
 of the given name is in use.
:param dialect_name: base name of the dialect which uses
 this type. (i.e. <code>'postgresql'</code>, <code>'mysql'</code>, etc.)</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="k">def</span> <span class="nf">with_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">dialect_name</span><span class="p">):</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Produce a new type object that will utilize the given</span>

<span class="sd">        type when applied to the dialect of the given name.</span>

<span class="sd">        e.g.::</span>

<span class="sd">            from sqlalchemy.types import String</span>

<span class="sd">            from sqlalchemy.dialects import mysql</span>

<span class="sd">            s = String()</span>

<span class="sd">            s = s.with_variant(mysql.VARCHAR(collation=&#39;foo&#39;), &#39;mysql&#39;)</span>

<span class="sd">        The construction of :meth:`.TypeEngine.with_variant` is always</span>

<span class="sd">        from the &quot;fallback&quot; type to that which is dialect specific.</span>

<span class="sd">        The returned type is an instance of :class:`.Variant`, which</span>

<span class="sd">        itself provides a :meth:`.Variant.with_variant`</span>

<span class="sd">        that can be called repeatedly.</span>

<span class="sd">        :param type\_: a :class:`.TypeEngine` that will be selected</span>

<span class="sd">         as a variant from the originating type, when a dialect</span>

<span class="sd">         of the given name is in use.</span>

<span class="sd">        :param dialect_name: base name of the dialect which uses</span>

<span class="sd">         this type. (i.e. ``&#39;postgresql&#39;``, ``&#39;mysql&#39;``, etc.)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Variant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="n">dialect_name</span><span class="p">:</span> <span class="n">to_instance</span><span class="p">(</span><span class="n">type_</span><span class="p">)})</span>
</code></pre></div>


</details>
<h3 id="metadata_1">Metadata</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Metadata</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store metadata information for every run.</p>
<p>If you happen to have some free-form data that belongs to the database,
this is the place for it.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Metadata</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;</span>

<span class="s">    Store metadata information for every run.</span>

<span class="s">    If you happen to have some free-form data that belongs to the database,</span>

<span class="s">    this is the place for it.</span>

<span class="s">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&quot;metadata&quot;</span>

    <span class="n">run_id</span> = <span class="n">Column</span>(<span class="n">Integer</span>,

                    <span class="n">ForeignKey</span>(<span class="s">&quot;run.id&quot;</span>, <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>,

                               <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>),

                    <span class="nb">index</span>=<span class="nb">True</span>,

                    <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="nb">name</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="nb">value</span> = <span class="n">Column</span>(<span class="n">String</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_3">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_4">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">run_id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">value</span>
</code></pre></div>


<h3 id="metric">Metric</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Metric</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store default metrics, simple name value store.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Metric</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;Store default metrics, simple name value store.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;metrics&#39;</span>

    <span class="nb">name</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="n">primary_key</span>=<span class="nb">True</span>, <span class="nb">index</span>=<span class="nb">True</span>, <span class="n">nullable</span>=<span class="nb">False</span>)

    <span class="nb">value</span> = <span class="n">Column</span>(<span class="n">Float</span>)

    <span class="n">run_id</span> = <span class="n">Column</span>(<span class="n">Integer</span>,

                    <span class="n">ForeignKey</span>(<span class="s">&quot;run.id&quot;</span>, <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>,

                               <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>),

                    <span class="nb">index</span>=<span class="nb">True</span>,

                    <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="n">def</span> <span class="n">__repr__</span>(<span class="nb">self</span>):

        <span class="k">return</span> <span class="s">&quot;{0} - {1}&quot;</span>.<span class="nb">format</span>(<span class="nb">self</span>.<span class="nb">name</span>, <span class="nb">self</span>.<span class="nb">value</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_4">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_5">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">run_id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">value</span>
</code></pre></div>


<h3 id="project">Project</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Project</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store project metadata.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Project</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;Store project metadata.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;project&#39;</span>

    <span class="nb">name</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="n">description</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="n">src_url</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="n">domain</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="n">group_name</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="nb">version</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="n">runs</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;Run&quot;</span>,

                               <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                               <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                               <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">def</span> <span class="n">__repr__</span>(<span class="nb">self</span>):

        <span class="k">return</span> <span class="s">&quot;&lt;Project {group}@{domain}/{name} V:{version}&gt;&quot;</span>.<span class="nb">format</span>(

            <span class="n">group</span>=<span class="nb">self</span>.<span class="n">group_name</span>,

            <span class="n">domain</span>=<span class="nb">self</span>.<span class="n">domain</span>,

            <span class="nb">name</span>=<span class="nb">self</span>.<span class="nb">name</span>,

            <span class="nb">version</span>=<span class="nb">self</span>.<span class="nb">version</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_5">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_6">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">description</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">domain</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">group_name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">runs</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">src_url</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">version</span>
</code></pre></div>


<h3 id="run">Run</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Run</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store a run for each executed test binary.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Run</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;Store a run for each executed test binary.&quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;run&#39;</span>

    <span class="n">__table_args__</span> = (<span class="n">ForeignKeyConstraint</span>(

        [<span class="s">&#39;project_name&#39;</span>, <span class="s">&#39;project_group&#39;</span>],

        [<span class="s">&#39;project.name&#39;</span>, <span class="s">&#39;project.group_name&#39;</span>],

        <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>,

        <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>),)

    <span class="nb">id</span> = <span class="n">Column</span>(<span class="n">Integer</span>, <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="nb">command</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="n">project_name</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">project_group</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">experiment_name</span> = <span class="n">Column</span>(<span class="n">String</span>, <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">run_group</span> = <span class="n">Column</span>(<span class="n">GUID</span>(<span class="n">as_uuid</span>=<span class="nb">True</span>), <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">experiment_group</span> = <span class="n">Column</span>(<span class="n">GUID</span>(<span class="n">as_uuid</span>=<span class="nb">True</span>),

                              <span class="n">ForeignKey</span>(<span class="s">&quot;experiment.id&quot;</span>,

                                         <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>,

                                         <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>),

                              <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">begin</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">end</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">status</span> = <span class="n">Column</span>(<span class="n">Enum</span>(<span class="s">&#39;completed&#39;</span>, <span class="s">&#39;running&#39;</span>, <span class="s">&#39;failed&#39;</span>, <span class="nb">name</span>=<span class="s">&quot;run_state&quot;</span>))

    <span class="n">metrics</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;Metric&quot;</span>,

                                  <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                                  <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                                  <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">logs</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;RunLog&quot;</span>,

                               <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                               <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                               <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">stored_data</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;Metadata&quot;</span>,

                                      <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                                      <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                                      <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">configurations</span> = <span class="n">sa</span>.<span class="n">orm</span>.<span class="n">relationship</span>(<span class="s">&quot;Config&quot;</span>,

                                         <span class="n">cascade</span>=<span class="s">&quot;all, delete-orphan&quot;</span>,

                                         <span class="n">passive_deletes</span>=<span class="nb">True</span>,

                                         <span class="n">passive_updates</span>=<span class="nb">True</span>)

    <span class="n">def</span> <span class="n">__repr__</span>(<span class="nb">self</span>):

        <span class="k">return</span> (<span class="s">&quot;&lt;Run: {0} status={1} run={2}&gt;&quot;</span>).<span class="nb">format</span>(<span class="nb">self</span>.<span class="n">project_name</span>,

                                                        <span class="nb">self</span>.<span class="nb">status</span>, <span class="nb">self</span>.<span class="nb">id</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_6">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_7">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">begin</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">command</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">configurations</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">experiment_group</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">experiment_name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="nb">id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">logs</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">metrics</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">project_group</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">project_name</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">run_group</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">status</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">stored_data</span>
</code></pre></div>


<h3 id="rungroup">RunGroup</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">RunGroup</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store information about a run group. </p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">RunGroup</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot; Store information about a run group. &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;rungroup&#39;</span>

    <span class="nb">id</span> = <span class="n">Column</span>(<span class="n">GUID</span>(<span class="n">as_uuid</span>=<span class="nb">True</span>), <span class="n">primary_key</span>=<span class="nb">True</span>, <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">experiment</span> = <span class="n">Column</span>(<span class="n">GUID</span>(<span class="n">as_uuid</span>=<span class="nb">True</span>),

                        <span class="n">ForeignKey</span>(<span class="s">&quot;experiment.id&quot;</span>,

                                   <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>,

                                   <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>),

                        <span class="nb">index</span>=<span class="nb">True</span>)

    <span class="n">begin</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">end</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">status</span> = <span class="n">Column</span>(<span class="n">Enum</span>(<span class="s">&#39;completed&#39;</span>, <span class="s">&#39;running&#39;</span>, <span class="s">&#39;failed&#39;</span>, <span class="nb">name</span>=<span class="s">&quot;run_state&quot;</span>))
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_7">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_8">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">begin</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">experiment</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="nb">id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">status</span>
</code></pre></div>


<h3 id="runlog">RunLog</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">RunLog</span><span class="p">(</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>


<p>Store log information for every run.</p>
<p>Properties like, start time, finish time, exit code, stderr, stdout
are stored here.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">RunLog</span>(<span class="n">BASE</span>):

    <span class="s">&quot;&quot;&quot;</span>

<span class="s">    Store log information for every run.</span>

<span class="s">    Properties like, start time, finish time, exit code, stderr, stdout</span>

<span class="s">    are stored here.</span>

<span class="s">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> = <span class="s">&#39;log&#39;</span>

    <span class="n">run_id</span> = <span class="n">Column</span>(<span class="n">Integer</span>,

                    <span class="n">ForeignKey</span>(<span class="s">&quot;run.id&quot;</span>, <span class="n">onupdate</span>=<span class="s">&quot;CASCADE&quot;</span>,

                               <span class="n">ondelete</span>=<span class="s">&quot;CASCADE&quot;</span>),

                    <span class="nb">index</span>=<span class="nb">True</span>,

                    <span class="n">primary_key</span>=<span class="nb">True</span>)

    <span class="n">begin</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">end</span> = <span class="n">Column</span>(<span class="nb">DateTime</span>(<span class="nb">timezone</span>=<span class="nb">False</span>))

    <span class="nb">status</span> = <span class="n">Column</span>(<span class="n">Integer</span>)

    <span class="nb">config</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="nb">stderr</span> = <span class="n">Column</span>(<span class="n">String</span>)

    <span class="nb">stdout</span> = <span class="n">Column</span>(<span class="n">String</span>)
</code></pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_8">Ancestors (in MRO)</h4>
<ul>
<li>benchbuild.utils.schema.Base</li>
</ul>
<h4 id="class-variables_9">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">begin</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">config</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">metadata</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">run_id</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">status</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">stderr</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">stdout</span>
</code></pre></div>


<h3 id="sessionmanager">SessionManager</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SessionManager</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nl">SessionManager</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">connect_engine</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Establish a connection to the database.</span>

<span class="ss">        Provides simple error handling for fatal errors.</span>

<span class="ss">        Returns:</span>

<span class="ss">            True, if we could establish a connection, else False.</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="k">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="k">connect</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">True</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">OperationalError</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">opex</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">LOG</span><span class="p">.</span><span class="n">fatal</span><span class="p">(</span><span class="ss">&quot;Could not connect to the database. The error was: &#39;%s&#39;&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">                      </span><span class="nf">str</span><span class="p">(</span><span class="n">opex</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">configure_engine</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Configure the databse connection.</span>

<span class="ss">        Sets appropriate transaction isolation levels and handle errors.</span>

<span class="ss">        Returns:</span>

<span class="ss">            True, if we did not encounter any unrecoverable errors, else False.</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="k">connection</span><span class="p">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">isolation_level</span><span class="o">=</span><span class="ss">&quot;SERIALIZABLE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="nl">ArgumentError</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">LOG</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Unable to set isolation level to SERIALIZABLE&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">True</span><span class="w"></span>

<span class="w">    </span><span class="nv">@exceptions</span><span class="p">(</span><span class="n">error_messages</span><span class="o">=</span><span class="err">{</span><span class="w"></span>

<span class="w">        </span><span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="nl">NoSuchModuleError</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;Connect string contained an invalid backend.&quot;</span><span class="w"></span>

<span class="w">    </span><span class="err">}</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">__test_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bool</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">CFG</span><span class="o">[</span><span class="n">&#39;db&#39;</span><span class="o">][</span><span class="n">&#39;rollback&#39;</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_engine</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">CFG</span><span class="o">[</span><span class="n">&quot;db&quot;</span><span class="o">][</span><span class="n">&quot;connect_string&quot;</span><span class="o">]</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">connect_engine</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">configure_engine</span><span class="p">())</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">sys</span><span class="p">.</span><span class="k">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">__transaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">__test_mode</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">LOG</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="ss">&quot;DB test mode active, all actions will be rolled back.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">__transaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="k">connection</span><span class="p">.</span><span class="k">begin</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">needed_schema</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="k">connection</span><span class="p">,</span><span class="w"> </span><span class="n">BASE</span><span class="p">.</span><span class="n">metadata</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">LOG</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Initialized new db schema.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">repo_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">enforce_versioning</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">repo_version</span><span class="p">,</span><span class="w"> </span><span class="n">db_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setup_versioning</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">maybe_update_db</span><span class="p">(</span><span class="n">repo_version</span><span class="p">,</span><span class="w"> </span><span class="n">db_version</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">get</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="k">connection</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__del__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__transaction&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">__transaction</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">__transaction</span><span class="p">.</span><span class="k">rollback</span><span class="p">()</span><span class="w"></span>
</code></pre></div>


</details>
<hr />
<h4 id="methods_1">Methods</h4>
<h5 id="configure_engine">configure_engine</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">configure_engine</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>


<p>Configure the databse connection.</p>
<p>Sets appropriate transaction isolation levels and handle errors.</p>
<p>Returns:
    True, if we did not encounter any unrecoverable errors, else False.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">configure_engine</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Configure the databse connection.</span>

<span class="ss">        Sets appropriate transaction isolation levels and handle errors.</span>

<span class="ss">        Returns:</span>

<span class="ss">            True, if we did not encounter any unrecoverable errors, else False.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="n">try</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="k">connection</span><span class="p">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">isolation_level</span><span class="o">=</span><span class="ss">&quot;SERIALIZABLE&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">ArgumentError</span><span class="p">:</span>

            <span class="n">LOG</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;Unable to set isolation level to SERIALIZABLE&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="k">True</span>
</code></pre></div>


</details>
<h5 id="connect_engine">connect_engine</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">connect_engine</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>


<p>Establish a connection to the database.</p>
<p>Provides simple error handling for fatal errors.</p>
<p>Returns:
    True, if we could establish a connection, else False.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">connect_engine</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Establish a connection to the database.</span>

<span class="ss">        Provides simple error handling for fatal errors.</span>

<span class="ss">        Returns:</span>

<span class="ss">            True, if we could establish a connection, else False.</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="n">try</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="k">connection</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="k">connect</span><span class="p">()</span>

            <span class="k">return</span> <span class="k">True</span>

        <span class="k">except</span> <span class="n">sa</span><span class="p">.</span><span class="n">exc</span><span class="p">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">opex</span><span class="p">:</span>

            <span class="n">LOG</span><span class="p">.</span><span class="n">fatal</span><span class="p">(</span><span class="ss">&quot;Could not connect to the database. The error was: &#39;%s&#39;&quot;</span><span class="p">,</span>

                      <span class="n">str</span><span class="p">(</span><span class="n">opex</span><span class="p">))</span>

        <span class="k">return</span> <span class="k">False</span>
</code></pre></div>


</details>
<h5 id="get">get</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>


<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">get</span><span class="p">(</span><span class="k">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="k">self</span><span class="p">.</span><span class="k">connection</span><span class="p">)</span>
</code></pre></div>


</details>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../schedule_tree/" title="Schedule Tree" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Schedule Tree
              </span>
            </div>
          </a>
        
        
          <a href="../settings/" title="Settings" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Settings
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.a14cc5fd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.7a2ea5ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>